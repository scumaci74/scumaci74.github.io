<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2563eb">
  <title>Offline Reader Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .animate-slide-in { animation: slideIn 0.3s ease-out; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50">
  <div id="app"></div>

  <script>
    // State
    let state = {
      articles: [],
      selectedArticle: null,
      view: 'list',
      showSettings: false,
      showAddUrl: false,
      loading: false,
      notification: null,
      searchQuery: '',
      apiKey: localStorage.getItem('apiKey') || '',
      provider: localStorage.getItem('provider') || 'gemini',
      urlInput: ''
    };

    // IndexedDB
    const DB_NAME = 'OfflineReaderDB';
    const STORE_NAME = 'articles';

    const openDB = () => {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, 1);
        request.onerror = () => reject(request.error);
        request.onsuccess = () => resolve(request.result);
        request.onupgradeneeded = (e) => {
          const db = e.target.result;
          if (!db.objectStoreNames.contains(STORE_NAME)) {
            db.createObjectStore(STORE_NAME, { keyPath: 'id' });
          }
        };
      });
    };

    const saveArticleToDB = async (article) => {
      const db = await openDB();
      return new Promise((resolve) => {
        const tx = db.transaction([STORE_NAME], 'readwrite');
        tx.objectStore(STORE_NAME).put(article);
        tx.oncomplete = () => resolve();
      });
    };

    const getAllArticles = async () => {
      const db = await openDB();
      return new Promise((resolve) => {
        const tx = db.transaction([STORE_NAME], 'readonly');
        const req = tx.objectStore(STORE_NAME).getAll();
        req.onsuccess = () => resolve(req.result);
      });
    };

    const deleteArticleFromDB = async (id) => {
      const db = await openDB();
      return new Promise((resolve) => {
        const tx = db.transaction([STORE_NAME], 'readwrite');
        tx.objectStore(STORE_NAME).delete(id);
        tx.oncomplete = () => resolve();
      });
    };

    // Utility Functions
    const showNotification = (message, type = 'success') => {
      state.notification = { message, type };
      render();
      setTimeout(() => {
        state.notification = null;
        render();
      }, 3000);
    };

    const fetchArticleContent = async (url) => {
      const response = await fetch(url);
      const html = await response.text();
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      
      ['script', 'style', 'nav', 'footer', 'header', 'iframe', 'aside'].forEach(tag => {
        doc.querySelectorAll(tag).forEach(el => el.remove());
      });
      
      const title = doc.querySelector('title')?.textContent || 
                   doc.querySelector('h1')?.textContent || 
                   'Articolo senza titolo';
      
      const article = doc.querySelector('article') || 
                     doc.querySelector('main') || 
                     doc.querySelector('.content') ||
                     doc.body;
      
      const content = article.innerText.trim().substring(0, 50000);
      
      return {
        id: Date.now(),
        url,
        title: title.substring(0, 200).trim(),
        content,
        savedAt: new Date().toISOString(),
        summary: null,
        translation: null
      };
    };

    const callAI = async (prompt) => {
      const { apiKey, provider } = state;
      
      if (provider === 'gemini') {
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }]
          })
        });
        if (!res.ok) throw new Error('Errore API Gemini');
        const data = await res.json();
        return data.candidates[0].content.parts[0].text;
      } else if (provider === 'openai') {
        const res = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json', 
            'Authorization': `Bearer ${apiKey}` 
          },
          body: JSON.stringify({
            model: 'gpt-4o-mini',
            messages: [{ role: 'user', content: prompt }],
            max_tokens: 1000
          })
        });
        if (!res.ok) throw new Error('Errore API OpenAI');
        const data = await res.json();
        return data.choices[0].message.content;
      } else if (provider === 'claude') {
        const res = await fetch('https://api.anthropic.com/v1/messages', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json', 
            'x-api-key': apiKey,
            'anthropic-version': '2023-06-01'
          },
          body: JSON.stringify({
            model: 'claude-3-5-sonnet-20241022',
            max_tokens: 1024,
            messages: [{ role: 'user', content: prompt }]
          })
        });
        if (!res.ok) throw new Error('Errore API Claude');
        const data = await res.json();
        return data.content[0].text;
      }
    };

    // Actions
    const addArticle = async () => {
      if (!state.urlInput.trim()) {
        showNotification('Inserisci un URL valido', 'error');
        return;
      }

      state.loading = true;
      render();

      try {
        const article = await fetchArticleContent(state.urlInput);
        await saveArticleToDB(article);
        state.articles.unshift(article);
        state.urlInput = '';
        state.showAddUrl = false;
        showNotification('✅ Articolo salvato!');
      } catch (error) {
        showNotification('Errore: ' + error.message, 'error');
      } finally {
        state.loading = false;
        render();
      }
    };

    const summarize = async (article) => {
      if (!state.apiKey) {
        showNotification('⚠️ Configura la chiave API', 'error');
        return;
      }

      state.loading = true;
      render();

      try {
        const prompt = `Crea un riassunto dettagliato in italiano di questo articolo, includendo i punti chiave:\n\n${article.content.substring(0, 12000)}`;
        const summary = await callAI(prompt);
        
        article.summary = summary;
        await saveArticleToDB(article);
        
        const index = state.articles.findIndex(a => a.id === article.id);
        if (index !== -1) state.articles[index] = article;
        if (state.selectedArticle?.id === article.id) state.selectedArticle = article;
        
        showNotification('✨ Riassunto generato!');
      } catch (error) {
        showNotification('Errore: ' + error.message, 'error');
      } finally {
        state.loading = false;
        render();
      }
    };

    const translate = async (article) => {
      if (!state.apiKey) {
        showNotification('⚠️ Configura la chiave API', 'error');
        return;
      }

      state.loading = true;
      render();

      try {
        const prompt = `Traduci questo testo in italiano mantenendo la formattazione:\n\n${article.content.substring(0, 12000)}`;
        const translation = await callAI(prompt);
        
        article.translation = translation;
        await saveArticleToDB(article);
        
        const index = state.articles.findIndex(a => a.id === article.id);
        if (index !== -1) state.articles[index] = article;
        if (state.selectedArticle?.id === article.id) state.selectedArticle = article;
        
        showNotification('🌍 Traduzione completata!');
      } catch (error) {
        showNotification('Errore: ' + error.message, 'error');
      } finally {
        state.loading = false;
        render();
      }
    };

    const exportArticle = (article) => {
      const content = `${article.title}\n\nURL: ${article.url}\nSalvato: ${new Date(article.savedAt).toLocaleString('it-IT')}\n\n${article.summary ? `━━━ RIASSUNTO ━━━\n${article.summary}\n\n` : ''}${article.translation ? `━━━ TRADUZIONE ━━━\n${article.translation}\n\n` : ''}━━━ CONTENUTO ━━━\n${article.content}`;
      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${article.title.substring(0, 50).replace(/[^a-z0-9]/gi, '_')}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      showNotification('📄 File esportato!');
    };

    const deleteArticle = async (id) => {
      if (!confirm('Eliminare questo articolo?')) return;
      
      await deleteArticleFromDB(id);
      state.articles = state.articles.filter(a => a.id !== id);
      
      if (state.selectedArticle?.id === id) {
        state.selectedArticle = null;
        state.view = 'list';
      }
      
      showNotification('🗑️ Articolo eliminato');
      render();
    };

    const saveSettings = () => {
      localStorage.setItem('apiKey', state.apiKey);
      localStorage.setItem('provider', state.provider);
      state.showSettings = false;
      showNotification('Impostazioni salvate!');
      render();
    };

    // Render
    const render = () => {
      const filteredArticles = state.articles.filter(a =>
        a.title.toLowerCase().includes(state.searchQuery.toLowerCase()) ||
        a.content.toLowerCase().includes(state.searchQuery.toLowerCase())
      );

      const app = document.getElementById('app');
      app.innerHTML = `
        <!-- Header -->
        <header class="bg-white border-b border-slate-200 sticky top-0 z-10 shadow-sm">
          <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center shadow">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                  <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                  <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                </svg>
              </div>
              <h1 class="text-xl font-bold text-slate-800">Offline Reader</h1>
            </div>
            <div class="flex gap-2">
              <button onclick="state.showAddUrl = true; render();" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:shadow-lg transition flex items-center gap-2 font-medium">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"/>
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                <span class="hidden sm:inline">Aggiungi</span>
              </button>
              <button onclick="state.showSettings = true; render();" class="p-2 text-slate-600 hover:bg-slate-100 rounded-lg transition">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M12 1v6m0 6v6"/>
                </svg>
              </button>
            </div>
          </div>
        </header>

        <!-- Notification -->
        ${state.notification ? `
          <div class="fixed top-20 right-4 left-4 sm:left-auto sm:w-96 z-50 px-4 py-3 rounded-lg shadow-2xl flex items-center gap-2 animate-slide-in ${state.notification.type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
            ${state.notification.message}
          </div>
        ` : ''}

        <!-- Settings Modal -->
        ${state.showSettings ? `
          <div class="fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl max-w-md w-full p-6 shadow-2xl">
              <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800">⚙️ Impostazioni</h2>
                <button onclick="state.showSettings = false; render();" class="text-slate-400 hover:text-slate-600">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                  </svg>
                </button>
              </div>
              
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2">Provider AI</label>
                  <select onchange="state.provider = this.value;" class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500">
                    <option value="gemini" ${state.provider === 'gemini' ? 'selected' : ''}>✨ Gemini (Google) - GRATIS</option>
                    <option value="openai" ${state.provider === 'openai' ? 'selected' : ''}>🤖 OpenAI (GPT-4)</option>
                    <option value="claude" ${state.provider === 'claude' ? 'selected' : ''}>🧠 Claude (Anthropic)</option>
                  </select>
                </div>
                
                <div>
                  <label class="block text-sm font-semibold text-slate-700 mb-2">Chiave API</label>
                  <input 
                    type="password" 
                    value="${state.apiKey}" 
                    oninput="state.apiKey = this.value;"
                    placeholder="${state.provider === 'gemini' ? 'AIza...' : 'sk-...'}"
                    class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500"
                  />
                  <p class="text-xs text-slate-500 mt-2">
                    ${state.provider === 'gemini' 
                      ? '🔑 Ottieni GRATIS su aistudio.google.com' 
                      : '🔒 Salvata in modo sicuro nel browser'}
                  </p>
                </div>

                <div class="pt-4 border-t border-slate-200">
                  <div class="bg-slate-50 rounded-lg p-3">
                    <p class="text-sm"><strong>${state.articles.length}</strong> articoli salvati</p>
                  </div>
                </div>
              </div>
              
              <button onclick="saveSettings();" class="w-full mt-6 px-4 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:shadow-lg transition font-semibold">
                Salva Impostazioni
              </button>
            </div>
          </div>
        ` : ''}

        <!-- Add URL Modal -->
        ${state.showAddUrl ? `
          <div class="fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl max-w-md w-full p-6 shadow-2xl">
              <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-slate-800">📥 Aggiungi Articolo</h2>
                <button onclick="state.showAddUrl = false; render();" class="text-slate-400 hover:text-slate-600">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                  </svg>
                </button>
              </div>
              
              <input 
                type="url" 
                value="${state.urlInput}" 
                oninput="state.urlInput = this.value;"
                onkeypress="if(event.key === 'Enter') addArticle();"
                placeholder="https://example.com/articolo"
                class="w-full px-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 mb-4"
                autofocus
              />
              
              <button 
                onclick="addArticle();" 
                ${state.loading ? 'disabled' : ''}
                class="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:shadow-lg transition font-semibold disabled:opacity-50"
              >
                ${state.loading ? '⏳ Download in corso...' : '💾 Scarica per Lettura Offline'}
              </button>
            </div>
          </div>
        ` : ''}

        <!-- Main Content -->
        <main class="max-w-6xl mx-auto px-4 py-6">
          ${state.view === 'list' ? `
            <!-- Search Bar -->
            ${state.articles.length > 0 ? `
              <div class="mb-6 relative">
                <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"/>
                  <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                </svg>
                <input 
                  type="text" 
                  value="${state.searchQuery}"
                  oninput="state.searchQuery = this.value; render();"
                  placeholder="Cerca negli articoli salvati..."
                  class="w-full pl-12 pr-4 py-3 border-2 border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500"
                />
              </div>
            ` : ''}

            <!-- Articles List -->
            <div class="grid gap-4">
              ${filteredArticles.length === 0 && state.articles.length === 0 ? `
                <div class="text-center py-20">
                  <div class="w-20 h-20 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2">
                      <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                      <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                    </svg>
                  </div>
                  <h3 class="text-xl font-bold text-slate-800 mb-2">Nessun articolo salvato</h3>
                  <p class="text-slate-500 mb-6">Inizia salvando il tuo primo articolo</p>
                  <button onclick="state.showAddUrl = true; render();" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:shadow-lg transition inline-flex items-center gap-2 font-semibold">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="12" y1="5" x2="12" y2="19"/>
                      <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Aggiungi Primo Articolo
                  </button>
                </div>
              ` : filteredArticles.length === 0 ? `
                <div class="text-center py-16">
                  <p class="text-slate-500 text-lg">Nessun risultato per "${state.searchQuery}"</p>
                </div>
              ` : filteredArticles.map(article => `
                <div class="bg-white rounded-xl p-5 shadow-sm hover:shadow-xl transition-all border border-slate-100 hover:border-blue-200">
                  <h3 class="font-bold text-slate-800 text-lg mb-2 line-clamp-2">${article.title}</h3>
                  <p class="text-sm text-slate-500 mb-3 flex items-center gap-2">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                      <polyline points="15 3 21 3 21 9"/>
                      <line x1="10" y1="14" x2="21" y2="3"/>
                    </svg>
                    ${new URL(article.url).hostname}
                    <span class="text-slate-300">•</span>
                    ${new Date(article.savedAt).toLocaleDateString('it-IT')}
                  </p>
                  <p class="text-slate-600 text-sm line-clamp-2 mb-4">${article.content.substring(0, 150)}...</p>
                  <div class="flex flex-wrap gap-2">
                    <button onclick="state.selectedArticle = ${JSON.stringify(article).replace(/"/g, '&quot;')}; state.view = 'reader'; render();" class="px-3 py-1.5 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition text-sm font-medium">
                      📖 Leggi
                    </button>
                    <button onclick='summarize(${JSON.stringify(article)});' ${state.loading ? 'disabled' : ''} class="px-3 py-1.5 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 transition text-sm font-medium disabled:opacity-50">
                      ✨ Riassumi
                    </button>
                    <button onclick='translate(${JSON.stringify(article)});' ${state.loading ? 'disabled' : ''} class="px-3 py-1.5 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition text-sm font-medium disabled:opacity-50">
                      🌍 Traduci
                    </button>
                    <button onclick='exportArticle(${JSON.stringify(article)});' class="px-3 py-1.5 bg-orange-50 text-orange-700 rounded-lg hover:bg-orange-100 transition text-sm font-medium">
                      📄 Esporta
                    </button>
                    <button onclick="deleteArticle(${article.id});" class="px-3 py-1.5 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition text-sm font-medium">
                      🗑️
                    </button>
                  </div>
                </div>
              `).join('')}
            </div>
          ` : `
            <!-- Reader View -->
            <div class="bg-white rounded-xl shadow-lg border border-slate-200">
              <div class="p-6 border-b border-slate-200">
                <button onclick="state.view = 'list'; state.selectedArticle = null; render();" class="text-blue-600 hover:text-blue-700 mb-4 flex items-center gap-2 font-medium">
                  ← Torna alla lista
                </button>
                <h2 class="text-2xl font-bold text-slate-800 mb-3">${state.selectedArticle?.title}</h2>
                <a href="${state.selectedArticle?.url}" target="_blank" class="text-sm text-blue-600 hover:underline flex items-center gap-2">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                    <polyline points="15 3 21 3 21 9"/>
                    <line x1="10" y1="14" x2="21" y2="3"/>
                  </svg>
                  ${state.selectedArticle?.url}
                </a>
                <p class="text-sm text-slate-500 mt-2">Salvato il ${new Date(state.selectedArticle?.savedAt).toLocaleString('it-IT')}</p>
              </div>

              <div class="p-6 border-b border-slate-200 flex flex-wrap gap-3">
                <button onclick='summarize(state.selectedArticle);' ${state.loading ? 'disabled' : ''} class="px-5 py-2.5 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:shadow-lg transition font-semibold disabled:opacity-50">
                  ✨ ${state.loading ? 'Generando...' : 'Genera Riassunto'}
                </button>
                <button onclick='translate(state.selectedArticle);' ${state.loading ? 'disabled' : ''} class="px-5 py-2.5 bg-gradient-to-r from-green-600 to-teal-600 text-white rounded-lg hover:shadow-lg transition font-semibold disabled:opacity-50">
                  🌍 ${state.loading ? 'Traducendo...' : 'Traduci'}
                </button>
                <button onclick='exportArticle(state.selectedArticle);' class="px-5 py-2.5 bg-gradient-to-r from-orange-600 to-red-600 text-white rounded-lg hover:shadow-lg transition font-semibold">
                  📄 Esporta
                </button>
              </div>

              <div class="p-6 max-w-3xl mx-auto">
                ${state.selectedArticle?.summary ? `
                  <div class="mb-8 p-6 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl border-2 border-purple-200 shadow-sm">
                    <h3 class="text-xl font-bold text-purple-900 mb-4 flex items-center gap-2">
                      ✨ Riassunto AI
                    </h3>
                    <p class="text-slate-800 whitespace-pre-wrap leading-relaxed">${state.selectedArticle.summary}</p>
                  </div>
                ` : ''}

                ${state.selectedArticle?.translation ? `
                  <div class="mb-8 p-6 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl border-2 border-green-200 shadow-sm">
                    <h3 class="text-xl font-bold text-green-900 mb-4 flex items-center gap-2">
                      🌍 Traduzione
                    </h3>
                    <p class="text-slate-800 whitespace-pre-wrap leading-relaxed">${state.selectedArticle.translation}</p>
                  </div>
                ` : ''}

                <div>
                  <h3 class="text-xl font-bold text-slate-800 mb-4 pb-3 border-b-2 border-slate-200">Contenuto Originale</h3>
                  <p class="text-slate-700 whitespace-pre-wrap leading-relaxed">${state.selectedArticle?.content}</p>
                </div>
              </div>
            </div>
          `}
        </main>

        <!-- Footer -->
        <footer class="max-w-6xl mx-auto px-4 py-6 text-center text-sm text-slate-500">
          <p>💡 <strong>Tip:</strong> Installa come app su iPhone: Safari → Condividi → Aggiungi a Home</p>
        </footer>
      `;
    };

    // Initialize
    (async () => {
      state.articles = await getAllArticles();
      state.articles.sort((a, b) => new Date(b.savedAt) - new Date(a.savedAt));
      
      const params = new URLSearchParams(window.location.search);
      const sharedUrl = params.get('add');
      if (sharedUrl) {
        state.urlInput = decodeURIComponent(sharedUrl);
        state.showAddUrl = true;
      }
      
      render();
    })();
  </script>
</body>
</html>